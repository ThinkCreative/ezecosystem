a:10:{s:7:"content";s:18867:"
<div class="class-blog extrainfo">
    <div class="columns-blog float-break">
        <div class="main-column-position">
            <div class="main-column float-break">
                <div class="border-box">
                <div class="border-tl"><div class="border-tr"><div class="border-tc"></div></div></div>
                <div class="border-ml"><div class="border-mr"><div class="border-mc float-break">

                        <div class="content-view-full">
                            <div class="class-blog-post float-break">

                                <div class="attribute-header">
                                    <h1>eZtip: Errors can be misleading...what happens when the DB is dead</h1>
                                </div>

                                <div class="attribute-byline">
				    <div><a href="http://feedproxy.google.com/~r/SuffandNonsense/~3/Q4S2rd4WR8g/eztip-errors-can-be-misleadingwhat.html">Read Original Item</a></div><br />
                                </div>

                                <div class="attribute-byline">
                                    <p class="date">11/11/2008 02:19 am</p>
                                    <p class="author">noreply@blogger.com (Bruce Morrison)</p>
				                                        <p class="tags"> Tags:
                                                                                      <a href="/Mirror/Bruce-Morrison/(id)/221/(tag)/tips" title="tips">tips</a>
                                                                                                                          </p>
				                                    </div>

				

				<div class="attribute-body float-break">
				      I recently received an email from an eZ community member stating after an abnormal  system reboot that their working eZ Publish install was reduced to responding with "Error / kernel (1) Access denied"<br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_DP-Lebx3cmk/SRjjueS7B6I/AAAAAAAAABs/crIeD3RyBUk/s1600-h/kernel_error_1.png"><img style="margin: 0px auto 10px; display: block; text-align: center; cursor: pointer; width: 320px; height: 176px;" src="http://3.bp.blogspot.com/_DP-Lebx3cmk/SRjjueS7B6I/AAAAAAAAABs/crIeD3RyBUk/s320/kernel_error_1.png" alt="" id="BLOGGER_PHOTO_ID_5267210151755712418" border="0" /></a><br />My suspicion was that there was an issue with the database. More than likely it had not successfully started when the system was brought up again.<br /><br />I tested this theory by stopping the database in my local development environment and accessing the associated eZ Publish site.  Manually editing the settings/siteaccess/eng/site.ini/append.php to turn on debugging confirms the problem and gives an insight into what is happening:<br /><br /><b><span style="color:orange;">Warning:</span> PHP</b><br /><pre>mysqli_connect() [&lt;a href='function.mysqli-connect'<br />&gt;function.mysqli-connect&lt;/a&gt;]:<br />(HY000/2002): Can't connect to local MySQL server through socket<br />'/var/run/mysqld/mysqld.sock' (2)<br />in /var/www/ezpublish-4.0.0-ezwebmin/lib/ezdb/classes/ezmysqlidb.php<br />on line 132</pre><br /><b><span style="color:red;">Error:</span> eZMySQLiDB</b><br /><pre>Connection error: Couldn't connect to database.<br />Please try again later or inform the system administrator.<br />Can't connect to local MySQL server through socket<br />'/var/run/mysqld/mysqld.sock' (2)</pre>One of the main concepts of eZ publish is that there is always a user associated with an access.  If a specific user is not logged in then the special "anonymous user" is utilised. The anonymous user exists and must be retrieved from the database so that the roles that are associated with it can be access and the permissions system can determine if the user has access to the requested resource.<br /><br /><b><span style="color:orange;">Warning:</span></b><pre>User not found, returning anonymous</pre><b><span style="color:orange;">Warning:</span></b><pre>Anonymous user not found, returning NoUser</pre>Because the database is not accessible the Anonymous user cannot be retrieved so the system creates a "dummy" eZUser object (NoUser) and returns that. (This behavior can bee seen in the eZUser:instance method in kernel/classes/datatypes/ezuser/ezuser.php)<br /><br />As NoUser does not exist and has no role information associated with it, not that any could be retrieved, the system responds with the access denied message.<br /><br />Now I'm sure that at some point eZ Publish raised an error on database connectivity issues instead of attempting to continue.  Having a poke through the source code I found kernel/error/errors.php contains:<br /><br /><code>/*!<br />No database connection<br />*/<br />define( 'EZ_ERROR_KERNEL_NO_DB_CONNECTION', 50 );</code><br /><br />Interestingly this constant doesn't appear anywhere else within the source.  I wonder why it is no longer used?<br /><br />As eZ Publish is pretty much useless when database access is not present the system should raise a specific DB error error when access cannot be established.  (Of course this could be overridden for each siteaccess). At the very least this would give the site owners a better indication of where to start looking for solutions.<br /><br />I've raised an issue <a href="http://issues.ez.no/IssueView.php?Id=13931&amp;activeItem=1">here</a>. I can't think of any reasons why this isn't a good idea.<br /><br />Update: The Admin siteaccess <span style="font-weight: bold;">does</span> display a the following error when the DB is not accessible:<br /><strong>kernel::50</strong><br /><ul><li>No database connection could be made, the system might not behave properly.</li></ul>Hat tip to <a href="http://andrewduck.name/">@andrewduck</a>. Will have to investigate...<div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/17515758-7122917601766493588?l=www.stuffandcontent.com' alt='' /></div>
<p><a href="http://feedads.g.doubleclick.net/~a/xkPcklrXU26ut4ft1I5UJhYo5jo/0/da"><img src="http://feedads.g.doubleclick.net/~a/xkPcklrXU26ut4ft1I5UJhYo5jo/0/di" border="0" ismap="true"></img></a><br/>
<a href="http://feedads.g.doubleclick.net/~a/xkPcklrXU26ut4ft1I5UJhYo5jo/1/da"><img src="http://feedads.g.doubleclick.net/~a/xkPcklrXU26ut4ft1I5UJhYo5jo/1/di" border="0" ismap="true"></img></a></p><img src="http://feeds.feedburner.com/~r/SuffandNonsense/~4/Q4S2rd4WR8g" height="1" width="1"/>
				</div>

                                    <div class="attribute-relatedcontent">
    <h1>Related content</h1>
    <ul>
            <li><a href="/Mirror/Share.ez.no-Blogs/Syntax-Color-with-eZ-Publish-5-XmlText-twig" title="Syntax Color with eZ Publish 5 XmlText (twig)">Syntax Color with eZ Publish 5 XmlText (twig)</a></li>
            <li><a href="/Mirror/Share.ez.no-Blogs/Alternativ-to-ImageMagick" title="Alternativ to ImageMagick">Alternativ to ImageMagick</a></li>
            <li><a href="/Mirror/Bruce-Morrison/10-Tips-for-New-eZ-Publish-Developers" title="10 Tips for New eZ Publish Developers">10 Tips for New eZ Publish Developers</a></li>
            <li><a href="/Mirror/Bruce-Morrison/French-version-of-10-Tips-for-New-eZ-Publish-Developers" title="French version of &quot;10 Tips for New eZ Publish Developers&quot;">French version of &quot;10 Tips for New eZ Publish Developers&quot;</a></li>
            <li><a href="/Mirror/Bruce-Morrison/eZtip-Get-the-current-siteaccess-from-template" title="eZtip: Get the current siteaccess from template">eZtip: Get the current siteaccess from template</a></li>
            <li><a href="/Mirror/Bruce-Morrison/eZ-Publish-4.2-User-module-to-get-workflow-triggers" title="eZ Publish 4.2 User module to get workflow triggers">eZ Publish 4.2 User module to get workflow triggers</a></li>
        </ul>
</div>
                                <div class="attribute-byline">
				    <div><a href="http://feedproxy.google.com/~r/SuffandNonsense/~3/Q4S2rd4WR8g/eztip-errors-can-be-misleadingwhat.html">Read Original Item</a></div>
                                </div>

                                                            </div>
                        </div>

                </div></div></div>
                <div class="border-bl"><div class="border-br"><div class="border-bc"></div></div></div>
                </div>
            </div>
        </div>

        <div class="extrainfo-column-position">
            <div class="extrainfo-column">
                <div class="border-box">
                <div class="border-tl"><div class="border-tr"><div class="border-tc"></div></div></div>
                <div class="border-ml"><div class="border-mr"><div class="border-mc float-break">
                                                <div class="attribute-tag-cloud">
                        <p>
                            <a href="/content/keyword/accessibility" style="font-size: 100%" title="1 objects tagged with 'accessibility'">accessibility</a> <a href="/content/keyword/conference" style="font-size: 100%" title="1 objects tagged with 'conference'">conference</a> <a href="/content/keyword/devops" style="font-size: 160%" title="4 objects tagged with 'devops'">devops</a> <a href="/content/keyword/distributed%20revision%20control" style="font-size: 100%" title="1 objects tagged with 'distributed revision control'">distributed revision control</a> <a href="/content/keyword/ez%20conference" style="font-size: 120%" title="2 objects tagged with 'ez conference'">ez conference</a> <a href="/content/keyword/ez%20publish" style="font-size: 200%" title="6 objects tagged with 'ez publish'">ez publish</a> <a href="/content/keyword/ezpublish" style="font-size: 120%" title="2 objects tagged with 'ezpublish'">ezpublish</a> <a href="/content/keyword/javascript" style="font-size: 100%" title="1 objects tagged with 'javascript'">javascript</a> <a href="/content/keyword/open%20social" style="font-size: 100%" title="1 objects tagged with 'open social'">open social</a> <a href="/content/keyword/Open%20Source" style="font-size: 100%" title="1 objects tagged with 'Open Source'">Open Source</a> <a href="/content/keyword/rant" style="font-size: 100%" title="1 objects tagged with 'rant'">rant</a> <a href="/content/keyword/tips" style="font-size: 180%" title="5 objects tagged with 'tips'">tips</a> <a href="/content/keyword/usability" style="font-size: 100%" title="1 objects tagged with 'usability'">usability</a> 
                        </p>
                        </div>

                        <div class="attribute-description">
                            
                        </div>

                        <div class="attribute-tags">
                            <h1>Tags</h1>
                            <ul>
                                                            <li><a href="/Mirror/Bruce-Morrison/(tag)/accessibility" title="accessibility">accessibility (1)</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(tag)/conference" title="conference">conference (1)</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(tag)/devops" title="devops">devops (4)</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(tag)/distributed%20revision%20control" title="distributed revision control">distributed revision control (1)</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(tag)/ez%20conference" title="ez conference">ez conference (2)</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(tag)/ez%20publish" title="ez publish">ez publish (6)</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(tag)/ezpublish" title="ezpublish">ezpublish (2)</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(tag)/javascript" title="javascript">javascript (1)</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(tag)/open%20social" title="open social">open social (1)</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(tag)/Open%20Source" title="Open Source">Open Source (1)</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(tag)/rant" title="rant">rant (1)</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(tag)/tips" title="tips">tips (5)</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(tag)/usability" title="usability">usability (1)</a></li>
                                                        </ul>
                        </div>

                        <div class="attribute-archive">
                            <h1>Archive</h1>
                            <ul>
                                                            <li><a href="/Mirror/Bruce-Morrison/(month)/5/(year)/2013" title="">May 2013</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(month)/4/(year)/2013" title="">April 2013</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(month)/12/(year)/2011" title="">December 2011</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(month)/12/(year)/2009" title="">December 2009</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(month)/10/(year)/2009" title="">October 2009</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(month)/9/(year)/2009" title="">September 2009</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(month)/8/(year)/2009" title="">August 2009</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(month)/4/(year)/2009" title="">April 2009</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(month)/12/(year)/2008" title="">December 2008</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(month)/11/(year)/2008" title="">November 2008</a></li>
                                                            <li><a href="/Mirror/Bruce-Morrison/(month)/10/(year)/2008" title="">October 2008</a></li>
                                                        </ul>
                        </div>

                        <!--START: CAL NAV -->
    
<div class="calendar">
<div class="calendar-tl"><div class="calendar-tr"><div class="calendar-bl"><div class="calendar-br">
<div class="content">

<div class="month">
<div class="previous">
<p><a href="/Mirror/Bruce-Morrison/(month)/7/(year)/2014" title="Previous month">&#8249;&#8249;<span class="hide"> Previous month</span></a></p>
</div>
<div class="next">
<p><a href="/Mirror/Bruce-Morrison/(month)/9/(year)/2014" title="Next month"><span class="hide">Next month </span>&#8250;&#8250;</a></p>
</div>
<h2>August&nbsp;2014</h2>
</div>

<div class="table">
<table cellspacing="0" border="0" summary="Calendar">
<tr class="top">
    <th class="left">Mon</th>
    <th>Tue</th>
    <th>Wed</th>
    <th>Thu</th>
    <th>Fri</th>
    <th>Sat</th>
    <th class="right">Sun</th>
</tr>                <tr class="">
                                            <td class="left">&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                            <td class=" ">
            1
        </td>
                            <td class=" ">
            2
        </td>
                                        <td class="  right">
            3
        </td>
                </tr>
                        <tr class="">
                    <td class="  left">
            4
        </td>
                            <td class=" ">
            5
        </td>
                            <td class=" ">
            6
        </td>
                            <td class=" ">
            7
        </td>
                            <td class=" ">
            8
        </td>
                            <td class=" ">
            9
        </td>
                                        <td class="  right">
            10
        </td>
                </tr>
                        <tr class="">
                    <td class="  left">
            11
        </td>
                            <td class=" ">
            12
        </td>
                            <td class=" ">
            13
        </td>
                            <td class=" ">
            14
        </td>
                            <td class=" ">
            15
        </td>
                            <td class=" ">
            16
        </td>
                                        <td class="  right">
            17
        </td>
                </tr>
                        <tr class="">
                    <td class="  left">
            18
        </td>
                            <td class=" ">
            19
        </td>
                            <td class=" ">
            20
        </td>
                            <td class=" ">
            21
        </td>
                            <td class=" ">
            22
        </td>
                            <td class=" ">
            23
        </td>
                                        <td class="  right">
            24
        </td>
                </tr>
                        <tr class="bottom">
                    <td class="  left">
            25
        </td>
                            <td class=" ">
            26
        </td>
                            <td class="currentselected today">
            27
        </td>
                            <td class=" ">
            28
        </td>
                            <td class=" ">
            29
        </td>
                            <td class=" ">
            30
        </td>
                                        <td class="  right">
            31
        </td>
                </tr>
        </table>
</div>

</div>
</div></div></div></div>
</div>

<!-- END: CAL NAV -->                </div></div></div>
                <div class="border-bl"><div class="border-br"><div class="border-bc"></div></div></div>
                </div>
            </div>
        </div>
    </div>
</div>";s:15:"view_parameters";a:5:{s:6:"offset";b:0;s:4:"year";b:0;s:5:"month";b:0;s:3:"day";b:0;s:10:"namefilter";b:0;}s:4:"path";a:4:{i:0;a:4:{s:4:"text";s:12:"eZ Ecosystem";s:3:"url";s:20:"/content/view/full/2";s:9:"url_alias";s:0:"";s:7:"node_id";s:1:"2";}i:1;a:4:{s:4:"text";s:6:"Mirror";s:3:"url";s:22:"/content/view/full/216";s:9:"url_alias";s:6:"Mirror";s:7:"node_id";s:3:"216";}i:2;a:4:{s:4:"text";s:14:"Bruce Morrison";s:3:"url";s:22:"/content/view/full/221";s:9:"url_alias";s:21:"Mirror/Bruce-Morrison";s:7:"node_id";s:3:"221";}i:3;a:4:{s:4:"text";s:66:"eZtip: Errors can be misleading...what happens when the DB is dead";s:3:"url";b:0;s:9:"url_alias";b:0;s:7:"node_id";s:4:"3677";}}s:10:"title_path";a:4:{i:0;a:4:{s:4:"text";s:12:"eZ Ecosystem";s:3:"url";s:20:"/content/view/full/2";s:9:"url_alias";s:0:"";s:7:"node_id";s:1:"2";}i:1;a:4:{s:4:"text";s:6:"Mirror";s:3:"url";s:22:"/content/view/full/216";s:9:"url_alias";s:6:"Mirror";s:7:"node_id";s:3:"216";}i:2;a:4:{s:4:"text";s:14:"Bruce Morrison";s:3:"url";s:22:"/content/view/full/221";s:9:"url_alias";s:21:"Mirror/Bruce-Morrison";s:7:"node_id";s:3:"221";}i:3;a:3:{s:4:"text";s:66:"eZtip: Errors can be misleading...what happens when the DB is dead";s:3:"url";b:0;s:9:"url_alias";b:0;}}s:10:"section_id";s:1:"1";s:7:"node_id";s:4:"3677";s:15:"navigation_part";s:23:"ezcontentnavigationpart";s:12:"content_info";a:24:{s:9:"object_id";s:4:"3677";s:7:"node_id";s:4:"3677";s:14:"parent_node_id";s:3:"221";s:8:"class_id";s:2:"20";s:16:"class_identifier";s:9:"blog_post";s:9:"remote_id";s:44:"RSSImport_3_ce94148b08fb3999d403c12eea04204a";s:14:"node_remote_id";s:32:"32470989e6a8506c8ae4e07bbd5c05d2";s:6:"offset";b:0;s:8:"viewmode";s:4:"full";s:26:"navigation_part_identifier";s:23:"ezcontentnavigationpart";s:10:"node_depth";s:1:"4";s:9:"url_alias";s:85:"Mirror/Bruce-Morrison/eZtip-Errors-can-be-misleading-what-happens-when-the-DB-is-dead";s:16:"current_language";s:6:"eng-US";s:13:"language_mask";s:1:"2";s:12:"main_node_id";s:4:"3677";s:19:"main_node_url_alias";b:0;s:19:"persistent_variable";a:2:{s:9:"left_menu";b:0;s:10:"extra_menu";b:0;}s:11:"class_group";b:0;s:5:"state";a:1:{i:2;s:1:"1";}s:16:"state_identifier";a:1:{i:0;s:18:"ez_lock/not_locked";}s:15:"parent_class_id";s:2:"19";s:23:"parent_class_identifier";s:4:"blog";s:21:"parent_node_remote_id";s:32:"d39ad4b05c0e7ec93696edb005c7c143";s:23:"parent_object_remote_id";s:32:"630be9a54193302ac1b42907cc07342a";}s:13:"template_list";a:3:{i:0;s:64:"extension/ezecosystem/design/eze/templates/tagcloud/tagcloud.tpl";i:1;s:61:"design/standard/templates/content/datatype/view/ezxmltext.tpl";i:2;s:66:"extension/ezwebin/design/ezwebin/templates/parts/blog/calendar.tpl";}s:9:"cache_ttl";i:-1;}