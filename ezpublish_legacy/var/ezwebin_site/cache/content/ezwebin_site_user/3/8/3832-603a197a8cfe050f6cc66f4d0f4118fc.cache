a:10:{s:7:"content";s:13440:"
<div class="class-blog extrainfo">
    <div class="columns-blog float-break">
        <div class="main-column-position">
            <div class="main-column float-break">
                <div class="border-box">
                <div class="border-tl"><div class="border-tr"><div class="border-tc"></div></div></div>
                <div class="border-ml"><div class="border-mr"><div class="border-mc float-break">

                        <div class="content-view-full">
                            <div class="class-blog-post float-break">

                                <div class="attribute-header">
                                    <h1>Custom top level nodes - is that possible? Round I - exploration...</h1>
                                </div>

                                <div class="attribute-byline">
				    <div><a href="http://ez.ryba.eu/index.php/ez_publish/lab/custom_top_level_nodes_is_that_possible_round_i_exploration">Read Original Item</a></div><br />
                                </div>

                                <div class="attribute-byline">
                                    <p class="date">12/29/2007 04:39 pm</p>
                                    <p class="author"></p>
				                                    </div>

				

				<div class="attribute-body float-break">
				      
<p>
<b>A</b><b>re custom top level nodes possible</b>? It is especially thrilling when one has encountered top level node problems ;) I forgot about this issue for quite some time, but now it's back. As I'm typing this post, I know that it won't provide an ultimate answer tonight, and some quick <b>NO</b> answers are within reach. Still, I want to give it a try. <b>Round I</b> - no particular goals, just exploration.
</p>

<p>
I run a fresh installation of eZ Publish 4.0.0 with just English language, URL addressing. When ready, I manually clean all the cache, just in case.
</p>

<p>
<b>So what top level nodes do we have?</b> Out of five available, there are three that seem to have much in common (all deal with content in a similar fashion), and just one of them - the media tree root - has a two-digit node ID (<b>43</b>) that will be easier to look for, than content's '2' ;)
</p>

<p>
<b>Let's look for some clues in the application.</b> I start with <b>/settings</b> directory as I know that it is where the top level nodes are actually declared. But just in case, I search through all the *.ini files. Only two files contain relevant 43 string: <b>menu.ini</b> in this context is only used for navigation part and tab configuration, no key information there, so let's skip it for now; <b>content.ini</b> contains the very declaration:
</p>
<div class="code">

<p>

[NodeSettings]<br />
 # The node ID of the normal content tree<br />
 RootNode=2<br />
 # The node ID of the user tree<br />
 UserRootNode=5<br />
 # The node ID for the media tree<br />
 MediaRootNode=43<br />
 # The node ID for the setup tree<br />
 SetupRootNode=48<br />
 # The node ID for the design tree<br /> DesignRootNode=58
</p>

</div>

<p>
The above code <b>doesn't seem</b> to suggest that extending top level was <b>ever planned</b>, but let's move on.
</p>

<p>
I log into the administration interface and create a folder called 'Custom', just under eZ Publish content tree root node. I memorize the new IDs: <b>59 as node ID</b> and <b>57 as content object ID </b>(the IDs you get may be different). I will need those as soon as I figure out what to destroy in the database ;) Basically, what I will try to do is to move this #59 node folder to the top level.
</p>

<p>
Let's look for some clues in the database now. I run a database search for any<b> 43-like</b> values in the entire table set (assuming that 43 will be the only way of referencing parts of the database that have something in common with the media root node). I get around 15 table hits, <b>6 of which</b> seem to be relevant. Now, by analysing the tables, I come up with the following decisions:
</p>

<ol>

<li><b>ezuser_role</b> - role configuration, 43 was there because of default editor role's limitations, I can skip this one</li>

<li>
<b>ezurlalias_ml</b> - URL aliases (multilanguage?), I update my 59 node just in case, md5 has to be calculated for lowercase 'custom' (probably a more complex rule behind this, but lowercase will do in this case):<br /><i>UPDATE ezurlalias_ml SET text='Custom', text_md5='8b9035807842a4e4dbe009f3f1478127' WHERE action='eznode:59'</i></li>

<li>
<b>ezurlalias</b> - URL aliases, I add a missing record, same md5 hash:<br /><i>INSERT INTO ezurlalias VALUES ('content/view/full/59', 0, NULL, 1, 1, 0, '8b9035807842a4e4dbe009f3f1478127', 'custom')</i></li>

<li><b>ezsearch_object_word_link</b> - search engine, can be reindexed, so let's skip this one...</li>

<li>
<b>eznode_assignment</b> - I have absolutely no idea what this table's for, so I just take a guess and change depth:<br /><i>UPDATE eznode_assignment SET parent_node=1 WHERE id=36</i></li>

<li>
<b>ezcontentobject_tree</b> - actual tree, I modify path string, parent node, identification string and depth - all for my folder:<br /><i>UPDATE ezcontentobject_tree SET path_string='/1/59/', parent_node_id=1, path_identification_string='custom', depth=1 WHERE path_string='/1/2/59/'</i></li>

</ol>

<p>
Just before I touch my eZ Publish interfaces, I clear all the cache, just in case again...
</p>

<p>
And here we go. From this moment on I have a sixth top level folder node. I don't have a tab and navigation part for it, yet, but I can access it by system URL: <b>/content/view/full/59</b>... Not only that... it seems to properly hold newly created child nodes. I can navigate through this new, hidden structure without visible problems, but...
</p>

<p>
...something must be missing, it's obvious when you search the kernel and libraries for 'MediaRootNode', 'RootNode', or 'UserRootNode', and see this:
</p>
<div class="code">

<p>

// /kernel/classes/ezcontentbrowse.php<br />
static function nodeAliasID( $nodeName )<br />
{<br />
 if ( is_numeric( $nodeName ) )<br />
 return $nodeName;<br />
 $browseINI = eZINI::instance( 'browse.ini' );<br />
 $aliasList = $browseINI->variable( 'BrowseSettings', 'AliasList' );<br />
 if ( isset( $aliasList[$nodeName] ) )<br />
 return $aliasList[$nodeName];<br />
 $contentINI = eZINI::instance( 'content.ini' );<br />
 if ( $nodeName == 'content' )<br />
 return $contentINI->variable( 'NodeSettings', 'RootNode' );<br />
 else if ( $nodeName == 'users' )<br />
 return $contentINI->variable( 'NodeSettings', 'UserRootNode' );<br />
 else if ( $nodeName == 'media' )<br />
 return $contentINI->variable( 'NodeSettings', 'MediaRootNode' );<br />
 else if ( $nodeName == 'setup' )<br />
 return $contentINI->variable( 'NodeSettings', 'SetupRootNode' );<br />
 else<br />
 return false;<br />}
</p>

</div>

<p>
But that's for another round...
</p>

				</div>

                                
                                <div class="attribute-byline">
				    <div><a href="http://ez.ryba.eu/index.php/ez_publish/lab/custom_top_level_nodes_is_that_possible_round_i_exploration">Read Original Item</a></div>
                                </div>

                                                            </div>
                        </div>

                </div></div></div>
                <div class="border-bl"><div class="border-br"><div class="border-bc"></div></div></div>
                </div>
            </div>
        </div>

        <div class="extrainfo-column-position">
            <div class="extrainfo-column">
                <div class="border-box">
                <div class="border-tl"><div class="border-tr"><div class="border-tc"></div></div></div>
                <div class="border-ml"><div class="border-mr"><div class="border-mc float-break">
                                                <div class="attribute-tag-cloud">
                        <p>
                            
                        </p>
                        </div>

                        <div class="attribute-description">
                            
                        </div>

                        <div class="attribute-tags">
                            <h1>Tags</h1>
                            <ul>
                                                        </ul>
                        </div>

                        <div class="attribute-archive">
                            <h1>Archive</h1>
                            <ul>
                                                            <li><a href="/Mirror/Nabil-Alimi/(month)/6/(year)/2008" title="">June 2008</a></li>
                                                            <li><a href="/Mirror/Nabil-Alimi/(month)/5/(year)/2008" title="">May 2008</a></li>
                                                            <li><a href="/Mirror/Nabil-Alimi/(month)/4/(year)/2008" title="">April 2008</a></li>
                                                            <li><a href="/Mirror/Nabil-Alimi/(month)/2/(year)/2008" title="">February 2008</a></li>
                                                            <li><a href="/Mirror/Nabil-Alimi/(month)/1/(year)/2008" title="">January 2008</a></li>
                                                            <li><a href="/Mirror/Nabil-Alimi/(month)/12/(year)/2007" title="">December 2007</a></li>
                                                        </ul>
                        </div>

                        <!--START: CAL NAV -->
    
<div class="calendar">
<div class="calendar-tl"><div class="calendar-tr"><div class="calendar-bl"><div class="calendar-br">
<div class="content">

<div class="month">
<div class="previous">
<p><a href="/Mirror/Nabil-Alimi/(month)/7/(year)/2014" title="Previous month">&#8249;&#8249;<span class="hide"> Previous month</span></a></p>
</div>
<div class="next">
<p><a href="/Mirror/Nabil-Alimi/(month)/9/(year)/2014" title="Next month"><span class="hide">Next month </span>&#8250;&#8250;</a></p>
</div>
<h2>August&nbsp;2014</h2>
</div>

<div class="table">
<table cellspacing="0" border="0" summary="Calendar">
<tr class="top">
    <th class="left">Mon</th>
    <th>Tue</th>
    <th>Wed</th>
    <th>Thu</th>
    <th>Fri</th>
    <th>Sat</th>
    <th class="right">Sun</th>
</tr>                <tr class="">
                                            <td class="left">&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                            <td class=" ">
            1
        </td>
                            <td class=" ">
            2
        </td>
                                        <td class="  right">
            3
        </td>
                </tr>
                        <tr class="">
                    <td class="  left">
            4
        </td>
                            <td class=" ">
            5
        </td>
                            <td class=" ">
            6
        </td>
                            <td class=" ">
            7
        </td>
                            <td class=" ">
            8
        </td>
                            <td class=" ">
            9
        </td>
                                        <td class="  right">
            10
        </td>
                </tr>
                        <tr class="">
                    <td class="  left">
            11
        </td>
                            <td class=" ">
            12
        </td>
                            <td class=" ">
            13
        </td>
                            <td class=" ">
            14
        </td>
                            <td class=" ">
            15
        </td>
                            <td class=" ">
            16
        </td>
                                        <td class="  right">
            17
        </td>
                </tr>
                        <tr class="">
                    <td class="  left">
            18
        </td>
                            <td class=" ">
            19
        </td>
                            <td class=" ">
            20
        </td>
                            <td class=" ">
            21
        </td>
                            <td class=" ">
            22
        </td>
                            <td class=" ">
            23
        </td>
                                        <td class="  right">
            24
        </td>
                </tr>
                        <tr class="bottom">
                    <td class="  left">
            25
        </td>
                            <td class="currentselected today">
            26
        </td>
                            <td class=" ">
            27
        </td>
                            <td class=" ">
            28
        </td>
                            <td class=" ">
            29
        </td>
                            <td class=" ">
            30
        </td>
                                        <td class="  right">
            31
        </td>
                </tr>
        </table>
</div>

</div>
</div></div></div></div>
</div>

<!-- END: CAL NAV -->                </div></div></div>
                <div class="border-bl"><div class="border-br"><div class="border-bc"></div></div></div>
                </div>
            </div>
        </div>
    </div>
</div>";s:15:"view_parameters";a:5:{s:6:"offset";b:0;s:4:"year";b:0;s:5:"month";b:0;s:3:"day";b:0;s:10:"namefilter";b:0;}s:4:"path";a:4:{i:0;a:4:{s:4:"text";s:12:"eZ Ecosystem";s:3:"url";s:20:"/content/view/full/2";s:9:"url_alias";s:0:"";s:7:"node_id";s:1:"2";}i:1;a:4:{s:4:"text";s:6:"Mirror";s:3:"url";s:22:"/content/view/full/216";s:9:"url_alias";s:6:"Mirror";s:7:"node_id";s:3:"216";}i:2;a:4:{s:4:"text";s:11:"Nabil Alimi";s:3:"url";s:22:"/content/view/full/232";s:9:"url_alias";s:18:"Mirror/Nabil-Alimi";s:7:"node_id";s:3:"232";}i:3;a:4:{s:4:"text";s:67:"Custom top level nodes - is that possible? Round I - exploration...";s:3:"url";b:0;s:9:"url_alias";b:0;s:7:"node_id";s:4:"3832";}}s:10:"title_path";a:4:{i:0;a:4:{s:4:"text";s:12:"eZ Ecosystem";s:3:"url";s:20:"/content/view/full/2";s:9:"url_alias";s:0:"";s:7:"node_id";s:1:"2";}i:1;a:4:{s:4:"text";s:6:"Mirror";s:3:"url";s:22:"/content/view/full/216";s:9:"url_alias";s:6:"Mirror";s:7:"node_id";s:3:"216";}i:2;a:4:{s:4:"text";s:11:"Nabil Alimi";s:3:"url";s:22:"/content/view/full/232";s:9:"url_alias";s:18:"Mirror/Nabil-Alimi";s:7:"node_id";s:3:"232";}i:3;a:3:{s:4:"text";s:67:"Custom top level nodes - is that possible? Round I - exploration...";s:3:"url";b:0;s:9:"url_alias";b:0;}}s:10:"section_id";s:1:"1";s:7:"node_id";s:4:"3832";s:15:"navigation_part";s:23:"ezcontentnavigationpart";s:12:"content_info";a:24:{s:9:"object_id";s:4:"3832";s:7:"node_id";s:4:"3832";s:14:"parent_node_id";s:3:"232";s:8:"class_id";s:2:"20";s:16:"class_identifier";s:9:"blog_post";s:9:"remote_id";s:45:"RSSImport_13_5f8350e6ea8be343f8880b7bc23c3a77";s:14:"node_remote_id";s:32:"a214cbe0feb9b027cab1a3358f50a2c0";s:6:"offset";b:0;s:8:"viewmode";s:4:"full";s:26:"navigation_part_identifier";s:23:"ezcontentnavigationpart";s:10:"node_depth";s:1:"4";s:9:"url_alias";s:78:"Mirror/Nabil-Alimi/Custom-top-level-nodes-is-that-possible-Round-I-exploration";s:16:"current_language";s:6:"eng-US";s:13:"language_mask";s:1:"2";s:12:"main_node_id";s:4:"3832";s:19:"main_node_url_alias";b:0;s:19:"persistent_variable";a:2:{s:9:"left_menu";b:0;s:10:"extra_menu";b:0;}s:11:"class_group";b:0;s:5:"state";a:1:{i:2;s:1:"1";}s:16:"state_identifier";a:1:{i:0;s:18:"ez_lock/not_locked";}s:15:"parent_class_id";s:2:"19";s:23:"parent_class_identifier";s:4:"blog";s:21:"parent_node_remote_id";s:32:"8f726b195ee3331aefd32c363f97ace6";s:23:"parent_object_remote_id";s:32:"eb3ec397bd26e4854a462950ecee1c9d";}s:13:"template_list";a:3:{i:0;s:64:"extension/ezecosystem/design/eze/templates/tagcloud/tagcloud.tpl";i:1;s:61:"design/standard/templates/content/datatype/view/ezxmltext.tpl";i:2;s:66:"extension/ezwebin/design/ezwebin/templates/parts/blog/calendar.tpl";}s:9:"cache_ttl";i:-1;}