a:10:{s:7:"content";s:76256:"
<div class="class-blog extrainfo">
    <div class="columns-blog float-break">
        <div class="main-column-position">
            <div class="main-column float-break">
                <div class="border-box">
                <div class="border-tl"><div class="border-tr"><div class="border-tc"></div></div></div>
                <div class="border-ml"><div class="border-mr"><div class="border-mc float-break">
            
                                            
<div class="content-view-line">
    <div class="class-blog-post float-break">

    <div class="attribute-header">
        <h1><a href="/Mirror/Netgen">Netgen</a></h1>
     </div>
    <div class="attribute-header">
        <h2>> <a href="http://www.netgen.hr/Blog/eZ-Partner-Conference-2012-in-Lisbon-Overview" title="eZ Partner Conference 2012 in Lisbon - Overview">eZ Partner Conference 2012 in Lisbon - Overview</a></h2>
     </div>

    <div class="attribute-byline">
	    </div>

    

    <div class="attribute-body float-break">
      
<div class="object-right"><div class="content-view-embed">
<div class="class-image">
    <div class="attribute-image">

    
        
    
                                                                                                                                            <img src="http://www.netgen.hr/var/ezflow_site/storage/images/media/images/lisbon/7140-1-cro-HR/Lisbon_large.jpg" width="330" height="440"  style="border: 0px solid ;" alt="Lisbon" title="Lisbon" />
            
    
    
    </div>

     </div>
</div>
</div><p>Usually I start with the event itself and mention the location at the end. This time the location really deserves to be mentioned first. In my humble opinion Lisbon was a bulls-eye decision due to the beautiful weather (sunny with almost 15 degrees Celsius) while most other parts of Europe were covered with snow and under freezing -15 degrees Celsius :). It was a great pleasure to enjoy the sun and discuss the future of eZ with other attendees.</p><p>Back to the eZ stuff.&nbsp;</p><p>Before writing this post I referenced <a href="http://www.netgen.hr/eng/Blog/eZ-Winter-Conference-2011-in-Nice-Summary" target="_self">the summary post from last years eZ Winter Conference</a>&nbsp;because the current CEO of <a href="http://ez.no" target="_self">eZ Systems</a>&nbsp;Gabriele Viebach took charge few month before that event and Nice was her first general introduction to eZ Community. So it was very interesting to compare topics from back then and to measure the progress in some way.&nbsp;</p><a name="eztoc7130_1" id="eztoc7130_1"></a><h2>Customer Experience Management&nbsp;</h2><p>What is really clear now, and was not clear last year, is that <b>eZ Systems is focusing on bigger clients as a vendor</b> (and not as a consultancy) <b>and actually has some powerful guns ready for the battle</b>. The shift started few years back and a big step was the split between the Community Edition and the Enterprise Edition. Last year we missed some good reasons why would the big clients use eZ Publish CMS Enterprise Edition. In my opinion support and maintenance was just not enough and I heard the same conclusion from other community members.</p><p>During the 2011 eZ Systems bought 2 companies: <b><a href="http://www.yoochoose.com" target="_self">Yoochoose</a></b> (recommendation engine service) and <b><a href="http://www.odoscope.com/%20" target="_self">Odoscope</a></b> (web analytics and optimization service). &nbsp;The plan in motion is to deeply integrate those 2 services in the Enterprise Edition to give a noticeable added value: <b>tools that can be used for increasing customer experience</b>. Of course, those are just 2 pieces in a bigger puzzle.&nbsp;</p><p>Last year <b><a href="http://ez.no/Products/eZ-Market" target="_self">eZ Market</a></b> was introduced. &nbsp;Maybe the wording was bad, but our first impressions were that eZ Systems wants to build something like the App Store where people can put their extension and sell them to the general public. After Lisbon <b>intentions of eZ Systems should be clear: they want partners and the community to build innovative extensions and sell them exclusively to their Enterprise clients with support included</b>. Knowing that they can’t develop all the new cool features for the ever-growing market, eZ Systems calls the community to participate. The difference from the App Store idea is that all eZ Market extensions would be certified and would not be sold to the general public, but just to the Enterprise clients. At least not in the short term.</p><p>To support this plan eZ Systems needs to give the community even better framework for development and innovation so <b>eZ in-house development power is currently focusing on features like <a href="http://share.ez.no/blogs/bertrand-dunogier/ez-publish-5-api-winter-facelift" target="_self">Public API</a> and REST API</b>. Also, an important part of the whole story is the cloud solution. eZ is <a href="http://ez.no/About-eZ/Events-News/News/eZ-Systems-Goes-Full-Cloud" target="_self">partnering with Ixonos </a>to deliver enterprise cloud services and to lower the “time to market”.&nbsp;The range of possible eZ Market extensions is really broad: from multisource to multichannel, from personalization to e-commerce, from various integration solutions that would interact with external services to low level stuff like replacing the persistent layer with some kind of nosql storage.</p><p>There are a lot of improvements eZ Systems needs to deliver to become a <b>full blown Customer Experience Management (CXM) solution provider</b>. The path is chosen and we shall see in a year or two was it the right one.&nbsp;</p><p>It is important to note that <b>there will always be the Community Edition of eZ Publish and community contributions that go with it</b>. Those are <b>giving a crucial advantage over closed source solutions in terms of innovation, education and crowdsourcing</b>, so eZ Systems needs to continue to nurture them with care. Also, an important thing is that the added value for the Enterprise clients (apart from maintenance and support) is provided through the eZ Market system, and the kernel is shared between Community and Enterprise Edition. So we all benefit from the innovation and the effort that goes into improving the core features of eZ Publish.</p><p><i>Disclaimer: this is my personal opinion about eZ Systems intentions, maybe I got it completely wrong, it is up to the reader to decide.&nbsp;</i></p><a name="eztoc7130_2" id="eztoc7130_2"></a><h2>Netgen Impact</h2><p>Our highlight at the conference was the presentation by myself on how to grow your business by more community engagement, summary of which you can find in <a href="http://share.ez.no/blogs/ivo-lukac/how-to-grow-your-business-through-more-community-engagement" target="_self">my post on share.ez.no</a>.&nbsp;</p><p>During the presentation we announced a new idea: to organize <b>Netgen eZ Publish Summer Camp</b> this year. We gathered feedback from the other partners during the conference and afterwards with a short survey. The feedback is really encouraging. 12 partners answered the survey and they committed to send 30 developers in total. Great number to start :) So last week we decided to put our efforts into it and the preparations are set in motion. More information will come out soon on this blog and on the community site, so keep an eye open!</p><p>Some slides from the conference (including mine) can be found in the <a href="http://share.ez.no/blogs/ez/wrap-up-of-the-ez-partner-conference-in-lisbon-slides" target="_self">wrap-up post by Nicolas Pastorino</a>. Check it out!</p><p>It was a real pleasure to talk with all the people present: the old ones and the new ones. <b>We are looking forward seeing you all at the Summer Conference and hopefully many of you at the Summer Camp in Croatia!</b></p>
<div class=""><div class="content-view-embed">
<div class="class-image">
    <div class="attribute-image">

    
        
    
                                                                                                                                            <img src="http://www.netgen.hr/var/ezflow_site/storage/images/media/images/ez-conference/7144-1-cro-HR/eZ-Conference_reference.jpg" width="620" height="465"  style="border: 0px solid ;" alt="eZ Conference" title="eZ Conference" />
            
    
    
    </div>

     </div>
</div>
</div>
    </div>

    <div class="attribute-url">
	<span>02/26/2012 12:58 pm</span> &nbsp; <a href="http://www.netgen.hr/eng/Blog">www.netgen.hr/eng/Blog</a> &nbsp; <a href="/Mirror/Netgen/eZ-Partner-Conference-2012-in-Lisbon-Overview">View mirror of item</a> &nbsp; <a href="http://www.netgen.hr/Blog/eZ-Partner-Conference-2012-in-Lisbon-Overview">View item</a>
    </div>

        

    </div>
</div>                            
<div class="content-view-line">
    <div class="class-blog-post float-break">

    <div class="attribute-header">
        <h1><a href="/Mirror/Netgen">Netgen</a></h1>
     </div>
    <div class="attribute-header">
        <h2>> <a href="http://www.netgenlabs.com/Blog/eZ-Partner-Conference-2012-in-Lisbon-Overview" title="eZ Partner Conference 2012 in Lisbon - Overview">eZ Partner Conference 2012 in Lisbon - Overview</a></h2>
     </div>

    <div class="attribute-byline">
	    </div>

    

    <div class="attribute-body float-break">
      
<div class="object-right"><div class="content-view-embed">
<div class="class-image">
    <div class="attribute-image">

    
        
    
                                                                                                                                            <img src="http://www.netgenlabs.com/var/ezflow_site/storage/images/media/images/lisbon/7140-1-cro-HR/Lisbon_large.jpg" width="330" height="440"  style="border: 0px solid ;" alt="Lisbon" title="Lisbon" />
            
    
    
    </div>

     </div>
</div>
</div><p>Usually I start with the event itself and mention the location at the end. This time the location really deserves to be mentioned first. In my humble opinion Lisbon was a bulls-eye decision due to the beautiful weather (sunny with almost 15 degrees Celsius) while most other parts of Europe were covered with snow and under freezing -15 degrees Celsius :). It was a great pleasure to enjoy the sun and discuss the future of eZ with other attendees.</p><p>Back to the eZ stuff.&nbsp;</p><p>Before writing this post I referenced <a href="http://www.netgenlabs.com/Blog/eZ-Winter-Conference-2011-in-Nice-Summary" target="_self">the summary post from last years eZ Winter Conference</a>&nbsp;because the current CEO of <a href="http://ez.no" target="_self">eZ Systems</a>&nbsp;Gabriele Viebach took charge few month before that event and Nice was her first general introduction to eZ Community. So it was very interesting to compare topics from back then and to measure the progress in some way.&nbsp;</p><a name="eztoc7130_1" id="eztoc7130_1"></a><h2>Customer Experience Management&nbsp;</h2><p>What is really clear now, and was not clear last year, is that <b>eZ Systems is focusing on bigger clients as a vendor</b> (and not as a consultancy) <b>and actually has some powerful guns ready for the battle</b>. The shift started few years back and a big step was the split between the Community Edition and the Enterprise Edition. Last year we missed some good reasons why would the big clients use eZ Publish CMS Enterprise Edition. In my opinion support and maintenance was just not enough and I heard the same conclusion from other community members.</p><p>During the 2011 eZ Systems bought 2 companies: <b><a href="http://www.yoochoose.com" target="_self">Yoochoose</a></b> (recommendation engine service) and <b><a href="http://www.odoscope.com/%20" target="_self">Odoscope</a></b> (web analytics and optimization service). &nbsp;The plan in motion is to deeply integrate those 2 services in the Enterprise Edition to give a noticeable added value: <b>tools that can be used for increasing customer experience</b>. Of course, those are just 2 pieces in a bigger puzzle.&nbsp;</p><p>Last year <b><a href="http://ez.no/Products/eZ-Market" target="_self">eZ Market</a></b> was introduced. &nbsp;Maybe the wording was bad, but our first impressions were that eZ Systems wants to build something like the App Store where people can put their extension and sell them to the general public. After Lisbon <b>intentions of eZ Systems should be clear: they want partners and the community to build innovative extensions and sell them exclusively to their Enterprise clients with support included</b>. Knowing that they can’t develop all the new cool features for the ever-growing market, eZ Systems calls the community to participate. The difference from the App Store idea is that all eZ Market extensions would be certified and would not be sold to the general public, but just to the Enterprise clients. At least not in the short term.</p><p>To support this plan eZ Systems needs to give the community even better framework for development and innovation so <b>eZ in-house development power is currently focusing on features like <a href="http://share.ez.no/blogs/bertrand-dunogier/ez-publish-5-api-winter-facelift" target="_self">Public API</a> and REST API</b>. Also, an important part of the whole story is the cloud solution. eZ is <a href="http://ez.no/About-eZ/Events-News/News/eZ-Systems-Goes-Full-Cloud" target="_self">partnering with Ixonos </a>to deliver enterprise cloud services and to lower the “time to market”.&nbsp;The range of possible eZ Market extensions is really broad: from multisource to multichannel, from personalization to e-commerce, from various integration solutions that would interact with external services to low level stuff like replacing the persistent layer with some kind of nosql storage.</p><p>There are a lot of improvements eZ Systems needs to deliver to become a <b>full blown Customer Experience Management (CXM) solution provider</b>. The path is chosen and we shall see in a year or two was it the right one.&nbsp;</p><p>It is important to note that <b>there will always be the Community Edition of eZ Publish and community contributions that go with it</b>. Those are <b>giving a crucial advantage over closed source solutions in terms of innovation, education and crowdsourcing</b>, so eZ Systems needs to continue to nurture them with care. Also, an important thing is that the added value for the Enterprise clients (apart from maintenance and support) is provided through the eZ Market system, and the kernel is shared between Community and Enterprise Edition. So we all benefit from the innovation and the effort that goes into improving the core features of eZ Publish.</p><p><i>Disclaimer: this is my personal opinion about eZ Systems intentions, maybe I got it completely wrong, it is up to the reader to decide.&nbsp;</i></p><a name="eztoc7130_2" id="eztoc7130_2"></a><h2>Netgen Impact</h2><p>Our highlight at the conference was the presentation by myself on how to grow your business by more community engagement, summary of which you can find in <a href="http://share.ez.no/blogs/ivo-lukac/how-to-grow-your-business-through-more-community-engagement" target="_self">my post on share.ez.no</a>.&nbsp;</p><p>During the presentation we announced a new idea: to organize <b>Netgen eZ Publish Summer Camp</b> this year. We gathered feedback from the other partners during the conference and afterwards with a short survey. The feedback is really encouraging. 12 partners answered the survey and they committed to send 30 developers in total. Great number to start :) So last week we decided to put our efforts into it and the preparations are set in motion. More information will come out soon on this blog and on the community site, so keep an eye open!</p><p>Some slides from the conference (including mine) can be found in the <a href="http://share.ez.no/blogs/ez/wrap-up-of-the-ez-partner-conference-in-lisbon-slides" target="_self">wrap-up post by Nicolas Pastorino</a>. Check it out!</p><p>It was a real pleasure to talk with all the people present: the old ones and the new ones. <b>We are looking forward seeing you all at the Summer Conference and hopefully many of you at the Summer Camp in Croatia!</b></p>
<div class=""><div class="content-view-embed">
<div class="class-image">
    <div class="attribute-image">

    
        
    
                                                                                                                                            <img src="http://www.netgenlabs.com/var/ezflow_site/storage/images/media/images/ez-conference/7144-1-cro-HR/eZ-Conference_reference.jpg" width="620" height="465"  style="border: 0px solid ;" alt="eZ Conference" title="eZ Conference" />
            
    
    
    </div>

     </div>
</div>
</div>
    </div>

    <div class="attribute-url">
	<span>02/26/2012 12:58 pm</span> &nbsp; <a href="http://www.netgen.hr/eng/Blog">www.netgen.hr/eng/Blog</a> &nbsp; <a href="/Mirror/Netgen/eZ-Partner-Conference-2012-in-Lisbon-Overview2">View mirror of item</a> &nbsp; <a href="http://www.netgenlabs.com/Blog/eZ-Partner-Conference-2012-in-Lisbon-Overview">View item</a>
    </div>

        

    </div>
</div>                            
<div class="content-view-line">
    <div class="class-blog-post float-break">

    <div class="attribute-header">
        <h1><a href="/Mirror/Netgen">Netgen</a></h1>
     </div>
    <div class="attribute-header">
        <h2>> <a href="http://www.netgen.hr/Blog/Confessions-of-an-apprentice-How-to-manipulate-data-from-an-eZ-Publish-database-with-PHP" title="Confessions of an apprentice: How to manipulate data from an eZ Publish database with PHP">Confessions of an apprentice: How to manipulate data from an eZ Pu ...</a></h2>
     </div>

    <div class="attribute-byline">
	    </div>

    

    <div class="attribute-body float-break">
      <p><b>&nbsp;</b></p><p>As you have probably realized by now, we are delving deeper into the PHP side of eZ Publish as this series of articles progresses. And that is a good thing, because until now, you have been limited to creating sites using the default eZ Publish functionalities. Which is enough for certain types of sites, and certain types of clients. But, as it is true in every line of work, clients tend to always ask for more. And a good programmer is ready for each and every type of situation.</p><p>This will be an extensive article covering the creation of custom database tables and explaining how to work with them in PHP. Therefore, the terms “object” and “class” we’ll be using in the rest of this article don’t refer to the eZ Publish objects and classes, but to the PHP ones.</p><a name="eztoc7120_1" id="eztoc7120_1"></a><h2>Creating custom database tables and manipulating them</h2><a name="eztoc7120_1_1" id="eztoc7120_1_1"></a><h3>What is the theory behind all of this?</h3><p>eZ Publish uses classes which extend the <b>eZPersistentObject</b> class to manipulate data in the database tables. One class per database table. The instances of this class (and all of those which extend the <b>eZPersistentObject</b> class) represent a row which is stored inside a table.</p><p>Now, the <b>eZPersistentObject</b> class represents a handy tool (or a set of tools, if you will) which enables us to manipulate the data in a table without the need od writing SQL queries all the time. Which is really great, because we are protected from SQL injection that way, also.</p><p>So, I will show you what the proper steps are in creating and manipulating a new database table for your project in the rest of this article.</p><a name="eztoc7120_1_2" id="eztoc7120_1_2"></a><h3>Creation of a database table</h3><p>Let’s say, for example, that you have set up a small web-shop and now you need to create some promotional discount codes for the users in order to make your products even more approachable. Those discount codes don’t always work, however, because you intend to apply them on certain dates or on certain periods of time.</p><p>The first thing we need to do is to create a table in our database which will store our discount codes. This table will need at least four fields: the discount code itself, the date when discount code validity starts, the date when discount code validity ends, and the percentage of the discount applied. We’ll also need an ID which will serve as the primary key on this table.</p><p>Create a new table like so:</p><pre>CREATE TABLE discount_code (
id INT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
discount_name VARCHAR(255) NOT NULL,
valid_from INT(11) NOT NULL,
valid_to INT(11) NOT NULL,
discount_amount FLOAT NOT NULL
);</pre><p>And there you have it, the structure of your table is ready. So, what did we do with this MySQL statement? Well, first off, we told SQL that we want to define a new table in our site’s database called discount_code. In it we’ve defined the structure we outlined in this article. So, we have a primary key called id, the name of our discount code called discount_name, values for the dates of the start and end of validity for our code, and the percentage we wish for our code to have.</p><a name="eztoc7120_1_3" id="eztoc7120_1_3"></a><h3>Manipulating the data in our custom database table</h3><p>After we’ve outlined our database table in this manner, we need to create its PHP class so that we can manipulate the data in the table itself. But before we actually create this class, let’s take a look at what we need to do with the rows in our table. We need to be able to create them, store any changes we might apply to them, and we need to be able to fetch those codes in a certain manner.</p><p>In regards to creation, storage and removal of rows of data, the <b>eZPersistentObject</b> class already has some methods which can help you in those tasks. As for the fetching the data, we need to determine what kind of fetches we need to implement. So, let’s say that we need to be able to fetch a table row by its ID, by its name, and a list of all the rows in a table. After that, we also need to know how many rows have already been created, and let’s say that we need to know if a row is actually applicable so that it can be used.</p><p>
We will create a class which extends the <b>eZPersistentObject</b> class, and its instances (objects) will manipulate the data in our table. We will put it in the classes folder of the module we have created before. <br />&nbsp;If you don’t have a <b>classes</b> folder for your module (for all intents and purposes, I’ll assume that it’s the <b>mymodule</b> we created earlier), please create it now. So, go to <b>extension/myextension/classes</b> folder and in it create a PHP file called <b>mydiscountcode.php</b>.</p><p>Open <b>mydiscountcode.php</b> and insert the following lines of code in it:</p><pre><?php&nbsp;
class myDiscountCode extends eZPersistentObject
{

function __construct($row)
{
parent::__construct($row);
}

static function definition()
{
return array(
'fields' => array( 'id'=>array('name'=>'ID', 'datatype'=>'integer', 'default'=>0, 'required'=>true),
'discount_name '=>array('name'=>'DiscountName', 'datatype'=>'string', 'default' => '', 'required' => true),
'valid_from'=>array('name'=>'ValidFrom', 'datatype'=>'integer', 'default'=>0, 'required'=>true),
'valid_to'=>array('name'=>'ValidTo', 'datatype' => 'integer', 'default' &nbsp;=> 0, 'required' => true),
'discount_amount'=>array('name'=>'DiscountAmount', 'datatype' => 'float', 'default' => 0, 'required' => true)
),
'keys' => array('id'),
'class_name' => 'myDiscountCode',
'sort' => array('valid_from' => 'desc'),
'name' => 'discount_code'
);
}

function isValid()
{
$currentTimeStamp = time();
if ( $currentTimeStamp >= (int) $this->attribute('valid_from') && $currentTimeStamp < (int) $this->attribute('valid_to') )
return true;
return false;
}

static function fetch($id)
{
return eZPersistentObject::fetchObject(self::definition(), null, array('id' => (int) $id));
}

static function fetchByDiscountName($discountName)
{
return eZPersistentObject::fetchObject(self::definition(), null, array( 'discount_name' => trim($discountCode) ) );
}

static function fetchCount()
{
return eZPersistentObject::count(self::definition());
}

static function fetchList($conds = null, $limit = null)
{
return eZPersistentObject::fetchObjectList(self::definition(), null, $conds, null, $limit);
}

?></pre><p>As you can see, we have defined a class called <b>myDiscountCode</b> which extends the already existing <b>eZPersistentObject</b> class. The constructor used here is very simple and just calls the constructor of the parent class to do the initialization for us. Also, most of the code here is reused from the <b>eZPersistentObject</b> class because it already has most of the functionalities we need.</p><p>Each and every class extending <b>eZPersistentObject</b> class has a <b>definition()</b> method which returns a single associative array. But it’s an important one because with this array, eZ Publish knows which table from the database to use, and what attributes/properties of a class to link with what values in the table we’ve defined before. Let’s break this array down to its fundamental elements.</p><p>It consists of five keys: <b>fields</b>, <b>function_attributes</b>, <b>keys</b>, <b>class_name</b>, <b>sort</b> and <b>name</b>. The <b>fields</b> key is the link from the class attributes to their respective database columns, and it’s also an associative array of values. As you can see, each attribute needs to have some information on which it is based. So, we need to define its name, its datatype, a default value, and whether it’s required or not. All of these, except the name, need to match the properties of the corresponding database column. On the other hand, for the name value you can assign any value you want.</p><p>The <b>keys</b> key is an array of fields used to uniquely define each row in our table. Since our table has a primary key called <b>id</b>, and it’s unique, this is the value we want the <b>keys</b> array to have.</p><p>The <b>class_name</b> key is the name of our class which extends the <b>eZPersistentObject</b> class.</p><p>The <b>sort</b> key is the default sorting mechanism you use when fetching table rows. In here we have said that we wish to sort our discount codes by using the <b>valid_from</b> attribute, descending, which means that the newest date in the database will be first, and the oldest one last.</p><p>And, finally, the <b>name</b> key contains the name of the actual database table we store our data in.</p><p>After we have created the definition array, we need to fill our class with some methods to work with our data.</p><p>So, the first method is the <b>isValid()</b> method, which checks the validity of the discount code in question. As you can see, it checks the current time, and if the current time is between the <b>valid_from</b> and <b>valid_to</b> times, it returns a value of <b>true</b>. Otherwise, it will return a <b>false</b> value.</p><p>After that, we have defined a static <b>fetch()</b> method which fetches the discount codes by their ids and returns the array of instances of our class. Each instance wraps one row from the database table. In here we actually use the inherited <b>eZPersistentObject</b> method called <b>fetchObject()</b> which accepts the following values: the definition array (which we created earlier), some field filters (which is currently set to null because we have no filters to apply - these filters are used only if you want to fetch some of the records from the database table), and the conditions by which we want to fetch our discount code (which in this case is defined by the array that specifies the ID of the row to fetch).</p><p>Since our table is fairly simple, all other methods also use methods from the <b>eZPersistentObject</b> class. You can find a full reference to the <b>eZPersistentObject</b> class <a href="http://pubsvn.ez.no/doxygen/trunk/html/classeZPersistentObject.html" target="_blank">here</a>.</p><p>Since this is such a major topic, I’m going to end today’s article on this note. We will explore how to use instances of our class in eZ Publish templates.</p><p>
Until next time, I wish you happy coding,<br />Tomislav</p>
    </div>

    <div class="attribute-url">
	<span>02/24/2012 04:40 am</span> &nbsp; <a href="http://www.netgen.hr/eng/Blog">www.netgen.hr/eng/Blog</a> &nbsp; <a href="/Mirror/Netgen/Confessions-of-an-apprentice-How-to-manipulate-data-from-an-eZ-Publish-database-with-PHP">View mirror of item</a> &nbsp; <a href="http://www.netgen.hr/Blog/Confessions-of-an-apprentice-How-to-manipulate-data-from-an-eZ-Publish-database-with-PHP">View item</a>
    </div>

        

    </div>
</div>                            
<div class="content-view-line">
    <div class="class-blog-post float-break">

    <div class="attribute-header">
        <h1><a href="/Mirror/Netgen">Netgen</a></h1>
     </div>
    <div class="attribute-header">
        <h2>> <a href="http://www.netgenlabs.com/Blog/Confessions-of-an-apprentice-How-to-manipulate-data-from-an-eZ-Publish-database-with-PHP" title="Confessions of an apprentice: How to manipulate data from an eZ Publish database with PHP">Confessions of an apprentice: How to manipulate data from an eZ Pu ...</a></h2>
     </div>

    <div class="attribute-byline">
	    </div>

    

    <div class="attribute-body float-break">
      <p>As you have probably realized by now, we are delving deeper into the PHP side of eZ Publish as this series of articles progresses. And that is a good thing, because until now, you have been limited to creating sites using the default eZ Publish functionalities. Which is enough for certain types of sites, and certain types of clients. But, as it is true in every line of work, clients tend to always ask for more. And a good programmer is ready for each and every type of situation.</p><p>This will be an extensive article covering the creation of custom database tables and explaining how to work with them in PHP. Therefore, the terms “object” and “class” we’ll be using in the rest of this article don’t refer to the eZ Publish objects and classes, but to the PHP ones.</p><a name="eztoc7120_1" id="eztoc7120_1"></a><h2>Creating custom database tables and manipulating them</h2><a name="eztoc7120_1_1" id="eztoc7120_1_1"></a><h3>What is the theory behind all of this?</h3><p>eZ Publish uses classes which extend the <b>eZPersistentObject</b> class to manipulate data in the database tables. One class per database table. The instances of this class (and all of those which extend the <b>eZPersistentObject</b> class) represent a row which is stored inside a table.</p><p>Now, the <b>eZPersistentObject</b> class represents a handy tool (or a set of tools, if you will) which enables us to manipulate the data in a table without the need od writing SQL queries all the time. Which is really great, because we are protected from SQL injection that way, also.</p><p>So, I will show you what the proper steps are in creating and manipulating a new database table for your project in the rest of this article.</p><a name="eztoc7120_1_2" id="eztoc7120_1_2"></a><h3>Creation of a database table</h3><p>Let’s say, for example, that you have set up a small web-shop and now you need to create some promotional discount codes for the users in order to make your products even more approachable. Those discount codes don’t always work, however, because you intend to apply them on certain dates or on certain periods of time.</p><p>The first thing we need to do is to create a table in our database which will store our discount codes. This table will need at least four fields: the discount code itself, the date when discount code validity starts, the date when discount code validity ends, and the percentage of the discount applied. We’ll also need an ID which will serve as the primary key on this table.</p><p>Create a new table like so:</p>	<pre class="mysql" style="font-family:monospace;"><a href="http://search.mysql.com/search?site=refman-%35%31&q=CREATE"><span style="color: #990099; font-weight: bold;">CREATE</span></a> <a href="http://search.mysql.com/search?site=refman-%35%31&q=TABLE"><span style="color: #990099; font-weight: bold;">TABLE</span></a> discount_code <span style="color: #FF00FF;">(</span>
    id <a href="http://search.mysql.com/search?site=refman-%35%31&q=INT"><span style="color: #999900; font-weight: bold;">INT</span></a><span style="color: #FF00FF;">(</span><span style="color: #008080;">11</span><span style="color: #FF00FF;">)</span> <a href="http://dev.mysql.com/doc/refman/%35%2E%31/en/non-typed-operators.html"><span style="color: #CC0099; font-weight: bold;">NOT</span></a> <a href="http://search.mysql.com/search?site=refman-%35%31&q=NULL"><span style="color: #9900FF; font-weight: bold;">NULL</span></a> <a href="http://search.mysql.com/search?site=refman-%35%31&q=AUTO_INCREMENT"><span style="color: #FF9900; font-weight: bold;">AUTO_INCREMENT</span></a> <a href="http://search.mysql.com/search?site=refman-%35%31&q=PRIMARY%20KEY"><span style="color: #990099; font-weight: bold;">PRIMARY KEY</span></a><span style="color: #000033;">,</span>
    discount_name <a href="http://search.mysql.com/search?site=refman-%35%31&q=VARCHAR"><span style="color: #999900; font-weight: bold;">VARCHAR</span></a><span style="color: #FF00FF;">(</span><span style="color: #008080;">255</span><span style="color: #FF00FF;">)</span> <a href="http://dev.mysql.com/doc/refman/%35%2E%31/en/non-typed-operators.html"><span style="color: #CC0099; font-weight: bold;">NOT</span></a> <a href="http://search.mysql.com/search?site=refman-%35%31&q=NULL"><span style="color: #9900FF; font-weight: bold;">NULL</span></a><span style="color: #000033;">,</span>
    valid_from <a href="http://search.mysql.com/search?site=refman-%35%31&q=INT"><span style="color: #999900; font-weight: bold;">INT</span></a><span style="color: #FF00FF;">(</span><span style="color: #008080;">11</span><span style="color: #FF00FF;">)</span> <a href="http://dev.mysql.com/doc/refman/%35%2E%31/en/non-typed-operators.html"><span style="color: #CC0099; font-weight: bold;">NOT</span></a> <a href="http://search.mysql.com/search?site=refman-%35%31&q=NULL"><span style="color: #9900FF; font-weight: bold;">NULL</span></a><span style="color: #000033;">,</span>
    valid_to <a href="http://search.mysql.com/search?site=refman-%35%31&q=INT"><span style="color: #999900; font-weight: bold;">INT</span></a><span style="color: #FF00FF;">(</span><span style="color: #008080;">11</span><span style="color: #FF00FF;">)</span> <a href="http://dev.mysql.com/doc/refman/%35%2E%31/en/non-typed-operators.html"><span style="color: #CC0099; font-weight: bold;">NOT</span></a> <a href="http://search.mysql.com/search?site=refman-%35%31&q=NULL"><span style="color: #9900FF; font-weight: bold;">NULL</span></a><span style="color: #000033;">,</span>
    discount_amount <a href="http://search.mysql.com/search?site=refman-%35%31&q=FLOAT"><span style="color: #999900; font-weight: bold;">FLOAT</span></a> <a href="http://dev.mysql.com/doc/refman/%35%2E%31/en/non-typed-operators.html"><span style="color: #CC0099; font-weight: bold;">NOT</span></a> <a href="http://search.mysql.com/search?site=refman-%35%31&q=NULL"><span style="color: #9900FF; font-weight: bold;">NULL</span></a>
<span style="color: #FF00FF;">)</span><span style="color: #000033;">;</span></pre><p>And there you have it, the structure of your table is ready. So, what did we do with this MySQL statement? Well, first off, we told SQL that we want to define a new table in our site’s database called discount_code. In it we’ve defined the structure we outlined in this article. So, we have a primary key called id, the name of our discount code called discount_name, values for the dates of the start and end of validity for our code, and the percentage we wish for our code to have.</p><a name="eztoc7120_1_3" id="eztoc7120_1_3"></a><h3>Manipulating the data in our custom database table</h3><p>After we’ve outlined our database table in this manner, we need to create its PHP class so that we can manipulate the data in the table itself. But before we actually create this class, let’s take a look at what we need to do with the rows in our table. We need to be able to create them, store any changes we might apply to them, and we need to be able to fetch those codes in a certain manner.</p><p>In regards to creation, storage and removal of rows of data, the <b>eZPersistentObject</b> class already has some methods which can help you in those tasks. As for the fetching the data, we need to determine what kind of fetches we need to implement. So, let’s say that we need to be able to fetch a table row by its ID, by its name, and a list of all the rows in a table. After that, we also need to know how many rows have already been created, and let’s say that we need to know if a row is actually applicable so that it can be used.</p><p>
We will create a class which extends the <b>eZPersistentObject</b> class, and its instances (objects) will manipulate the data in our table. We will put it in the classes folder of the module we have created before. <br />&nbsp;If you don’t have a <b>classes</b> folder for your module (for all intents and purposes, I’ll assume that it’s the <b>mymodule</b> we created earlier), please create it now. So, go to <b>extension/myextension/classes</b> folder and in it create a PHP file called <b>mydiscountcode.php</b>.</p><p>Open <b>mydiscountcode.php</b> and insert the following lines of code in it:</p>	<pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;"><?php</span>
<span style="color: #000000; font-weight: bold;">class</span> myDiscountCode <span style="color: #000000; font-weight: bold;">extends</span> eZPersistentObject
<span style="color: #009900;">{</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">function</span> __construct<span style="color: #009900;">(</span><span style="color: #000088;">$row</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
    parent<span style="color: #339933;">::</span>__construct<span style="color: #009900;">(</span><span style="color: #000088;">$row</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
static <span style="color: #000000; font-weight: bold;">function</span> definition<span style="color: #009900;">(</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
    <span style="color: #b1b100;">return</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">(</span>
                <span style="color: #0000ff;">'fields'</span> <span style="color: #339933;">=></span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">(</span>
                            <span style="color: #0000ff;">'id'</span><span style="color: #339933;">=></span><a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">(</span><span style="color: #0000ff;">'name'</span><span style="color: #339933;">=></span><span style="color: #0000ff;">'ID'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'datatype'</span><span style="color: #339933;">=></span><span style="color: #0000ff;">'integer'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'default'</span><span style="color: #339933;">=></span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'required'</span><span style="color: #339933;">=></span><span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>
                            <span style="color: #0000ff;">'discount_name '</span><span style="color: #339933;">=></span><a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">(</span><span style="color: #0000ff;">'name'</span><span style="color: #339933;">=></span><span style="color: #0000ff;">'DiscountName'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'datatype'</span><span style="color: #339933;">=></span><span style="color: #0000ff;">'string'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'default'</span> <span style="color: #339933;">=></span> <span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'required'</span> <span style="color: #339933;">=></span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>
                            <span style="color: #0000ff;">'valid_from'</span><span style="color: #339933;">=></span><a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">(</span><span style="color: #0000ff;">'name'</span><span style="color: #339933;">=></span><span style="color: #0000ff;">'ValidFrom'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'datatype'</span><span style="color: #339933;">=></span><span style="color: #0000ff;">'integer'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'default'</span><span style="color: #339933;">=></span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'required'</span><span style="color: #339933;">=></span><span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>
                            <span style="color: #0000ff;">'valid_to'</span><span style="color: #339933;">=></span><a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">(</span><span style="color: #0000ff;">'name'</span><span style="color: #339933;">=></span><span style="color: #0000ff;">'ValidTo'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'datatype'</span> <span style="color: #339933;">=></span> <span style="color: #0000ff;">'integer'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'default'</span> <span style="color: #339933;">&</span>nbsp<span style="color: #339933;">;=></span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'required'</span> <span style="color: #339933;">=></span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>
                            <span style="color: #0000ff;">'discount_amount'</span><span style="color: #339933;">=></span><a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">(</span><span style="color: #0000ff;">'name'</span><span style="color: #339933;">=></span><span style="color: #0000ff;">'DiscountAmount'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'datatype'</span> <span style="color: #339933;">=></span> <span style="color: #0000ff;">'float'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'default'</span> <span style="color: #339933;">=></span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'required'</span> <span style="color: #339933;">=></span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">)</span>
                <span style="color: #009900;">)</span><span style="color: #339933;">,</span>
                <span style="color: #0000ff;">'keys'</span> <span style="color: #339933;">=></span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">(</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>
                <span style="color: #0000ff;">'class_name'</span> <span style="color: #339933;">=></span> <span style="color: #0000ff;">'myDiscountCode'</span><span style="color: #339933;">,</span>
                <span style="color: #0000ff;">'sort'</span> <span style="color: #339933;">=></span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">(</span><span style="color: #0000ff;">'valid_from'</span> <span style="color: #339933;">=></span> <span style="color: #0000ff;">'desc'</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>
                <span style="color: #0000ff;">'name'</span> <span style="color: #339933;">=></span> <span style="color: #0000ff;">'discount_code'</span>
    <span style="color: #009900;">)</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">function</span> isValid<span style="color: #009900;">(</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
    <span style="color: #000088;">$currentTimeStamp</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/time"><span style="color: #990000;">time</span></a><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">(</span> <span style="color: #000088;">$currentTimeStamp</span> <span style="color: #339933;">>=</span> <span style="color: #009900;">(</span>int<span style="color: #009900;">)</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-></span><span style="color: #004000;">attribute</span><span style="color: #009900;">(</span><span style="color: #0000ff;">'valid_from'</span><span style="color: #009900;">)</span> <span style="color: #339933;">&&</span> <span style="color: #000088;">$currentTimeStamp</span> <span style="color: #339933;"><</span> <span style="color: #009900;">(</span>int<span style="color: #009900;">)</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-></span><span style="color: #004000;">attribute</span><span style="color: #009900;">(</span><span style="color: #0000ff;">'valid_to'</span><span style="color: #009900;">)</span> <span style="color: #009900;">)</span>
        <span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
static <span style="color: #000000; font-weight: bold;">function</span> fetch<span style="color: #009900;">(</span><span style="color: #000088;">$id</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
    <span style="color: #b1b100;">return</span> eZPersistentObject<span style="color: #339933;">::</span><span style="color: #004000;">fetchObject</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">definition</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #339933;">,</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">(</span><span style="color: #0000ff;">'id'</span> <span style="color: #339933;">=></span> <span style="color: #009900;">(</span>int<span style="color: #009900;">)</span> <span style="color: #000088;">$id</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
static <span style="color: #000000; font-weight: bold;">function</span> fetchByDiscountName<span style="color: #009900;">(</span><span style="color: #000088;">$discountName</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
    <span style="color: #b1b100;">return</span> eZPersistentObject<span style="color: #339933;">::</span><span style="color: #004000;">fetchObject</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">definition</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #339933;">,</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">(</span> <span style="color: #0000ff;">'discount_name'</span> <span style="color: #339933;">=></span> <a href="http://www.php.net/trim"><span style="color: #990000;">trim</span></a><span style="color: #009900;">(</span><span style="color: #000088;">$discountCode</span><span style="color: #009900;">)</span> <span style="color: #009900;">)</span> <span style="color: #009900;">)</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
static <span style="color: #000000; font-weight: bold;">function</span> fetchCount<span style="color: #009900;">(</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
    <span style="color: #b1b100;">return</span> eZPersistentObject<span style="color: #339933;">::</span><a href="http://www.php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">definition</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
static <span style="color: #000000; font-weight: bold;">function</span> fetchList<span style="color: #009900;">(</span><span style="color: #000088;">$conds</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #339933;">,</span> <span style="color: #000088;">$limit</span> <span style="color: #339933;">=</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
    <span style="color: #b1b100;">return</span> eZPersistentObject<span style="color: #339933;">::</span><span style="color: #004000;">fetchObjectList</span><span style="color: #009900;">(</span><span style="color: #000000; font-weight: bold;">self</span><span style="color: #339933;">::</span><span style="color: #004000;">definition</span><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #339933;">,</span> <span style="color: #000088;">$conds</span><span style="color: #339933;">,</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #339933;">,</span> <span style="color: #000088;">$limit</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
<span style="color: #009900;">}</span>
<span style="color: #000000; font-weight: bold;">?></span></pre><p>As you can see, we have defined a class called <b>myDiscountCode</b> which extends the already existing <b>eZPersistentObject</b> class. The constructor used here is very simple and just calls the constructor of the parent class to do the initialization for us. Also, most of the code here is reused from the <b>eZPersistentObject</b> class because it already has most of the functionalities we need.</p><p>Each and every class extending <b>eZPersistentObject</b> class has a <b>definition()</b> method which returns a single associative array. But it’s an important one because with this array, eZ Publish knows which table from the database to use, and what attributes/properties of a class to link with what values in the table we’ve defined before. Let’s break this array down to its fundamental elements.</p><p>It consists of five keys: <b>fields</b>, <b>function_attributes</b>, <b>keys</b>, <b>class_name</b>, <b>sort</b> and <b>name</b>. The <b>fields</b> key is the link from the class attributes to their respective database columns, and it’s also an associative array of values. As you can see, each attribute needs to have some information on which it is based. So, we need to define its name, its datatype, a default value, and whether it’s required or not. All of these, except the name, need to match the properties of the corresponding database column. On the other hand, for the name value you can assign any value you want.</p><p>The <b>keys</b> key is an array of fields used to uniquely define each row in our table. Since our table has a primary key called <b>id</b>, and it’s unique, this is the value we want the <b>keys</b> array to have.</p><p>The <b>class_name</b> key is the name of our class which extends the <b>eZPersistentObject</b> class.</p><p>The <b>sort</b> key is the default sorting mechanism you use when fetching table rows. In here we have said that we wish to sort our discount codes by using the <b>valid_from</b> attribute, descending, which means that the newest date in the database will be first, and the oldest one last.</p><p>And, finally, the <b>name</b> key contains the name of the actual database table we store our data in.</p><p>After we have created the definition array, we need to fill our class with some methods to work with our data.</p><p>So, the first method is the <b>isValid()</b> method, which checks the validity of the discount code in question. As you can see, it checks the current time, and if the current time is between the <b>valid_from</b> and <b>valid_to</b> times, it returns a value of <b>true</b>. Otherwise, it will return a <b>false</b> value.</p><p>After that, we have defined a static <b>fetch()</b> method which fetches the discount codes by their ids and returns the array of instances of our class. Each instance wraps one row from the database table. In here we actually use the inherited <b>eZPersistentObject</b> method called <b>fetchObject()</b> which accepts the following values: the definition array (which we created earlier), some field filters (which is currently set to null because we have no filters to apply - these filters are used only if you want to fetch some of the records from the database table), and the conditions by which we want to fetch our discount code (which in this case is defined by the array that specifies the ID of the row to fetch).</p><p>Since our table is fairly simple, all other methods also use methods from the <b>eZPersistentObject</b> class. You can find a full reference to the <b>eZPersistentObject</b> class <a href="http://pubsvn.ez.no/doxygen/trunk/html/classeZPersistentObject.html" target="_blank">here</a>.</p><p>Since this is such a major topic, I’m going to end today’s article on this note. We will explore how to use instances of our class in eZ Publish templates.</p><p>
Until next time, I wish you happy coding,<br />Tomislav</p>
    </div>

    <div class="attribute-url">
	<span>02/24/2012 04:40 am</span> &nbsp; <a href="http://www.netgen.hr/eng/Blog">www.netgen.hr/eng/Blog</a> &nbsp; <a href="/Mirror/Netgen/Confessions-of-an-apprentice-How-to-manipulate-data-from-an-eZ-Publish-database-with-PHP2">View mirror of item</a> &nbsp; <a href="http://www.netgenlabs.com/Blog/Confessions-of-an-apprentice-How-to-manipulate-data-from-an-eZ-Publish-database-with-PHP">View item</a>
    </div>

        

    </div>
</div>                            
<div class="content-view-line">
    <div class="class-blog-post float-break">

    <div class="attribute-header">
        <h1><a href="/Mirror/Netgen">Netgen</a></h1>
     </div>
    <div class="attribute-header">
        <h2>> <a href="http://www.netgen.hr/Blog/Changing-class-of-an-existing-object" title="Changing class of an existing object in eZ Publish CMS">Changing class of an existing object in eZ Publish CMS</a></h2>
     </div>

    <div class="attribute-byline">
	    </div>

    

    <div class="attribute-body float-break">
      <p>A good practice in eZ Publish development is to specify the content classes (or content types) at the beginning of the project. But of course in real situations there is a big chance that something needs to be changed at later stage or even after going live. What is great with eZ is that you can easily change content types either by adding new attributes or removing the ones that are not needed. And that ability covers a lot of situation, but not all.</p><p>
For example imagine a following scenario:<br />
- a class is specified and created<br />
- lot objects of that class are created too<br />
- you realize that some of that objects should be of different class<br />- you need to convert some existing objects to that different class&nbsp;</p><p>You can create the second class but the problem is that you already have the content. The swap node feature can help if the number of objects you want to change is low. &nbsp;</p><p>But what to do if you need to change the class for a lot of existing objects? You could create an export/import script, but that takes time too. There was an extension for changing class on existing objects: <a href="http://projects.ez.no/object_content_class_change" target="_self">http://projects.ez.no/object_content_class_change</a> but its outdated (would be nice if someone could upgrade it to PHP5 and eZ 4.2+).</p><p>There is a quick solution but its not for people with weak hearth :)</p>
<ol>

<li>create the new class by copying the old one and note the new class id (e.g. 111)</li>

<li>note all class attribute ids from the old class (e.g. 222,223)</li>

<li>note all class attribute ids from the new class (e.g. 333,334 )</li>

<li>collect object ids for objects you want to change class (e.g. 444,555,777,888)</li>

<li>
go to your database console and verify that you have good ids:<br /><i>select * from ezcontentobject where id in (444,555,777,888)</i></li>

<li>backup your database (just in case)</li>

<li>lock object changes to ensure that nobody changes those objects while doing this (the safest way is to just shutdown the web site or disable login for editors)</li>

<li>
run the following SQL command to update ezcontentobject table:<br /><i>update ezcontentobject set contentclass_id = 111 where id in (444,555,777,888)</i></li>

<li>
run following SQL commands to update ezcontentobject_attribute table for each attribute:<br />
<i>update ezcontentobject_attribute set contentclassattribute_id = 333 where contentobject_id in (444,555,777,888) and contentclassattribute_id = 222;</i><br /><i>update ezcontentobject_attribute set contentclassattribute_id = 334 where contentobject_id in (444,555,777,888) and contentclassattribute_id = 223;</i></li>

<li>Clear the related content caches</li>

<li>Do your changes on the new class</li>

</ol>
<p>
Important thing is that you can “map” attributes only of the same datatype. Otherwise you can break the eZ data model. So the first step is crucial to create the exact same copy of the class. Afterwards, in step 11, you can do changes to your new class.So far I didn't need this to often so there is no script. It would be rather simple to create a script which could hide few steps (like 2., 3., 8., and 9.).&nbsp;<br /><b>DISCLAIMER: No warranty! Backup before doing this!</b></p>
    </div>

    <div class="attribute-url">
	<span>02/20/2012 03:27 pm</span> &nbsp; <a href="http://www.netgen.hr/eng/Blog">www.netgen.hr/eng/Blog</a> &nbsp; <a href="/Mirror/Netgen/Changing-class-of-an-existing-object-in-eZ-Publish-CMS">View mirror of item</a> &nbsp; <a href="http://www.netgen.hr/Blog/Changing-class-of-an-existing-object">View item</a>
    </div>

        

    </div>
</div>                            
<div class="content-view-line">
    <div class="class-blog-post float-break">

    <div class="attribute-header">
        <h1><a href="/Mirror/Netgen">Netgen</a></h1>
     </div>
    <div class="attribute-header">
        <h2>> <a href="http://www.netgenlabs.com/Blog/Changing-class-of-an-existing-object" title="Changing class of an existing object in eZ Publish CMS">Changing class of an existing object in eZ Publish CMS</a></h2>
     </div>

    <div class="attribute-byline">
	    </div>

    

    <div class="attribute-body float-break">
      <p>A good practice in eZ Publish development is to specify the content classes (or content types) at the beginning of the project. But of course in real situations there is a big chance that something needs to be changed at later stage or even after going live. What is great with eZ is that you can easily change content types either by adding new attributes or removing the ones that are not needed. And that ability covers a lot of situation, but not all.</p><p>
For example imagine a following scenario:<br />
- a class is specified and created<br />
- lot objects of that class are created too<br />
- you realize that some of that objects should be of different class<br />- you need to convert some existing objects to that different class&nbsp;</p><p>You can create the second class but the problem is that you already have the content. The swap node feature can help if the number of objects you want to change is low. &nbsp;</p><p>But what to do if you need to change the class for a lot of existing objects? You could create an export/import script, but that takes time too. There was an extension for changing class on existing objects: <a href="http://projects.ez.no/object_content_class_change" target="_self">http://projects.ez.no/object_content_class_change</a> but its outdated (would be nice if someone could upgrade it to PHP5 and eZ 4.2+).</p><p>There is a quick solution but its not for people with weak hearth :)</p>
<ol>

<li>create the new class by copying the old one and note the new class id (e.g. 111)</li>

<li>note all class attribute ids from the old class (e.g. 222,223)</li>

<li>note all class attribute ids from the new class (e.g. 333,334 )</li>

<li>collect object ids for objects you want to change class (e.g. 444,555,777,888)</li>

<li>
go to your database console and verify that you have good ids:<br /><i>select * from ezcontentobject where id in (444,555,777,888)</i></li>

<li>backup your database (just in case)</li>

<li>lock object changes to ensure that nobody changes those objects while doing this (the safest way is to just shutdown the web site or disable login for editors)</li>

<li>
run the following SQL command to update ezcontentobject table:<br /><i>update ezcontentobject set contentclass_id = 111 where id in (444,555,777,888)</i></li>

<li>
run following SQL commands to update ezcontentobject_attribute table for each attribute:<br />
<i>update ezcontentobject_attribute set contentclassattribute_id = 333 where contentobject_id in (444,555,777,888) and contentclassattribute_id = 222;</i><br /><i>update ezcontentobject_attribute set contentclassattribute_id = 334 where contentobject_id in (444,555,777,888) and contentclassattribute_id = 223;</i></li>

<li>Clear the related content caches</li>

<li>Do your changes on the new class</li>

</ol>
<p>
Important thing is that you can “map” attributes only of the same datatype. Otherwise you can break the eZ data model. So the first step is crucial to create the exact same copy of the class. Afterwards, in step 11, you can do changes to your new class.So far I didn't need this to often so there is no script. It would be rather simple to create a script which could hide few steps (like 2., 3., 8., and 9.).&nbsp;<br /><b>DISCLAIMER: No warranty! Backup before doing this!</b></p>
    </div>

    <div class="attribute-url">
	<span>02/20/2012 03:27 pm</span> &nbsp; <a href="http://www.netgen.hr/eng/Blog">www.netgen.hr/eng/Blog</a> &nbsp; <a href="/Mirror/Netgen/Changing-class-of-an-existing-object-in-eZ-Publish-CMS2">View mirror of item</a> &nbsp; <a href="http://www.netgenlabs.com/Blog/Changing-class-of-an-existing-object">View item</a>
    </div>

        

    </div>
</div>                        
                  

 

                </div></div></div>
                <div class="border-bl"><div class="border-br"><div class="border-bc"></div></div></div>
                </div>
            </div>
        </div>

        <div class="extrainfo-column-position">
            <div class="extrainfo-column">
                <div class="border-box">
                <div class="border-tl"><div class="border-tr"><div class="border-tc"></div></div></div>
                <div class="border-ml"><div class="border-mr"><div class="border-mc float-break">
                                                <div class="attribute-tag-cloud">
                        <p>
                            
                        </p>
                        </div>

                        <div class="attribute-description">
                            
                        </div>

                        <div class="attribute-tags">
                            <h1>Tags</h1>
                            <ul>
                                                        </ul>
                        </div>

                        <div class="attribute-archive">
                            <h1>Archive</h1>
                            <ul>
                                                            <li><a href="/Mirror/Netgen/(month)/8/(year)/2014" title="">August 2014</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/7/(year)/2014" title="">July 2014</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/5/(year)/2014" title="">May 2014</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/4/(year)/2014" title="">April 2014</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/3/(year)/2014" title="">March 2014</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/2/(year)/2014" title="">February 2014</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/1/(year)/2014" title="">January 2014</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/12/(year)/2013" title="">December 2013</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/11/(year)/2013" title="">November 2013</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/10/(year)/2013" title="">October 2013</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/9/(year)/2013" title="">September 2013</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/8/(year)/2013" title="">August 2013</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/7/(year)/2013" title="">July 2013</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/6/(year)/2013" title="">June 2013</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/5/(year)/2013" title="">May 2013</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/4/(year)/2013" title="">April 2013</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/3/(year)/2013" title="">March 2013</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/2/(year)/2013" title="">February 2013</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/1/(year)/2013" title="">January 2013</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/11/(year)/2012" title="">November 2012</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/9/(year)/2012" title="">September 2012</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/8/(year)/2012" title="">August 2012</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/7/(year)/2012" title="">July 2012</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/6/(year)/2012" title="">June 2012</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/5/(year)/2012" title="">May 2012</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/4/(year)/2012" title="">April 2012</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/3/(year)/2012" title="">March 2012</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/2/(year)/2012" title="">February 2012</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/1/(year)/2012" title="">January 2012</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/12/(year)/2011" title="">December 2011</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/11/(year)/2011" title="">November 2011</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/10/(year)/2011" title="">October 2011</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/9/(year)/2011" title="">September 2011</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/8/(year)/2011" title="">August 2011</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/6/(year)/2011" title="">June 2011</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/5/(year)/2011" title="">May 2011</a></li>
                                                            <li><a href="/Mirror/Netgen/(month)/4/(year)/2011" title="">April 2011</a></li>
                                                        </ul>
                        </div>

                        <!--START: CAL NAV -->
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
<div class="calendar">
<div class="calendar-tl"><div class="calendar-tr"><div class="calendar-bl"><div class="calendar-br">
<div class="content">

<div class="month">
<div class="previous">
<p><a href="/Mirror/Netgen/(month)/1/(year)/2012" title="Previous month">&#8249;&#8249;<span class="hide"> Previous month</span></a></p>
</div>
<div class="next">
<p><a href="/Mirror/Netgen/(month)/3/(year)/2012" title="Next month"><span class="hide">Next month </span>&#8250;&#8250;</a></p>
</div>
<h2>February&nbsp;2012</h2>
</div>

<div class="table">
<table cellspacing="0" border="0" summary="Calendar">
<tr class="top">
    <th class="left">Mon</th>
    <th>Tue</th>
    <th>Wed</th>
    <th>Thu</th>
    <th>Fri</th>
    <th>Sat</th>
    <th class="right">Sun</th>
</tr>                <tr class="">
                                            <td class="left">&nbsp;</td>
                                <td>&nbsp;</td>
                            <td class="currentselected ">
            1
        </td>
                            <td class=" ">
            2
        </td>
                            <td class=" ">
            3
        </td>
                            <td class=" ">
            4
        </td>
                                        <td class="  right">
            5
        </td>
                </tr>
                        <tr class="">
                    <td class="  left">
            6
        </td>
                            <td class=" ">
            7
        </td>
                            <td class=" ">
            8
        </td>
                            <td class=" ">
            9
        </td>
                            <td class=" ">
            10
        </td>
                            <td class=" ">
            11
        </td>
                                        <td class="  right">
            12
        </td>
                </tr>
                        <tr class="">
                    <td class="  left">
            13
        </td>
                            <td class=" ">
            14
        </td>
                            <td class=" ">
            15
        </td>
                            <td class=" ">
            16
        </td>
                            <td class=" ">
            17
        </td>
                            <td class=" ">
            18
        </td>
                                        <td class="  right">
            19
        </td>
                </tr>
                        <tr class="">
                    <td class="  left">
            <em><a href="/Mirror/Netgen/(day)/20/(month)/2/(year)/2012">20</a></em>
        </td>
                            <td class=" ">
            21
        </td>
                            <td class=" ">
            22
        </td>
                            <td class=" ">
            23
        </td>
                            <td class=" ">
            <em><a href="/Mirror/Netgen/(day)/24/(month)/2/(year)/2012">24</a></em>
        </td>
                            <td class=" ">
            25
        </td>
                                        <td class="  right">
            <em><a href="/Mirror/Netgen/(day)/26/(month)/2/(year)/2012">26</a></em>
        </td>
                </tr>
                        <tr class="bottom">
                    <td class="  left">
            27
        </td>
                            <td class=" ">
            28
        </td>
                            <td class=" ">
            29
        </td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td class="right">&nbsp;</td>
                                    </tr>
        </table>
</div>

</div>
</div></div></div></div>
</div>

<!-- END: CAL NAV -->                </div></div></div>
                <div class="border-bl"><div class="border-br"><div class="border-bc"></div></div></div>
                </div>
            </div>
        </div>
    </div>
</div>";s:15:"view_parameters";a:5:{s:6:"offset";b:0;s:4:"year";s:4:"2012";s:5:"month";s:1:"2";s:3:"day";b:0;s:10:"namefilter";b:0;}s:4:"path";a:3:{i:0;a:4:{s:4:"text";s:12:"eZ Ecosystem";s:3:"url";s:20:"/content/view/full/2";s:9:"url_alias";s:0:"";s:7:"node_id";s:1:"2";}i:1;a:4:{s:4:"text";s:6:"Mirror";s:3:"url";s:22:"/content/view/full/216";s:9:"url_alias";s:6:"Mirror";s:7:"node_id";s:3:"216";}i:2;a:4:{s:4:"text";s:6:"Netgen";s:3:"url";b:0;s:9:"url_alias";b:0;s:7:"node_id";s:3:"228";}}s:10:"title_path";a:3:{i:0;a:4:{s:4:"text";s:12:"eZ Ecosystem";s:3:"url";s:20:"/content/view/full/2";s:9:"url_alias";s:0:"";s:7:"node_id";s:1:"2";}i:1;a:4:{s:4:"text";s:6:"Mirror";s:3:"url";s:22:"/content/view/full/216";s:9:"url_alias";s:6:"Mirror";s:7:"node_id";s:3:"216";}i:2;a:3:{s:4:"text";s:6:"Netgen";s:3:"url";b:0;s:9:"url_alias";b:0;}}s:10:"section_id";s:1:"1";s:7:"node_id";s:3:"228";s:15:"navigation_part";s:23:"ezcontentnavigationpart";s:12:"content_info";a:24:{s:9:"object_id";s:3:"226";s:7:"node_id";s:3:"228";s:14:"parent_node_id";s:3:"216";s:8:"class_id";s:2:"19";s:16:"class_identifier";s:4:"blog";s:9:"remote_id";s:32:"7f359aaa74ea9081f7b9d7c57013072d";s:14:"node_remote_id";s:32:"80d65711644b755185f988f146faca0d";s:6:"offset";b:0;s:8:"viewmode";s:4:"full";s:26:"navigation_part_identifier";s:23:"ezcontentnavigationpart";s:10:"node_depth";s:1:"3";s:9:"url_alias";s:13:"Mirror/Netgen";s:16:"current_language";s:6:"eng-US";s:13:"language_mask";s:1:"2";s:12:"main_node_id";s:3:"228";s:19:"main_node_url_alias";b:0;s:19:"persistent_variable";a:2:{s:9:"left_menu";b:0;s:10:"extra_menu";b:0;}s:11:"class_group";b:0;s:5:"state";a:1:{i:2;s:1:"1";}s:16:"state_identifier";a:1:{i:0;s:18:"ez_lock/not_locked";}s:15:"parent_class_id";s:1:"1";s:23:"parent_class_identifier";s:6:"folder";s:21:"parent_node_remote_id";s:32:"418ada46ecd2d42b7744e9cee6c51085";s:23:"parent_object_remote_id";s:32:"5b6a5a0179108fb40b786874ab09d743";}s:13:"template_list";a:3:{i:0;s:64:"extension/ezecosystem/design/eze/templates/tagcloud/tagcloud.tpl";i:1;s:61:"design/standard/templates/content/datatype/view/ezxmltext.tpl";i:2;s:66:"extension/ezwebin/design/ezwebin/templates/parts/blog/calendar.tpl";}s:9:"cache_ttl";i:-1;}